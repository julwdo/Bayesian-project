lwd = 2,
xlim = c(min(n), max(n) + 3)  # extend x-axis for visibility
)
# Overlay theoretical Poisson CDF
x_vals <- min(n):(max(n) + 3)
lines(x_vals, ppois(x_vals, lambda = theta),
col = "red", lwd = 2, lty = 2, type = "s")  # 's' for step
legend("bottomright",
legend = c("Empirical CDF", "Posterior Poisson CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# NEW
# Diagnostics
jags_model <- jags.model(
textConnection(model_code),
data = rytgaard1990_input,
inits = inits_list,
n.chains = 3,
n.adapt = 0
)
# Sample from posterior
samples <- coda.samples(
jags_model,
variable.names = c("alpha", "beta", "theta"),
n.iter = 50000
)
gelman.diag(samples)
gelman.plot(samples)
View(samples)
traceplot(samples_trimmed[, "alpha"])
# ===================================================
# LOAD LIBRARIES
# ===================================================
library(CASdatasets)
library(dplyr)
library(rjags)
library(coda)
# ===================================================
# RYTGAARD1990 EXAMPLE DATA
# ===================================================
rytgaard1990_input <- list(
y = c(2.495, 2.120, 2.095, 1.700, 1.650, 1.985, 1.810, 1.625,
3.215, 2.105, 1.765, 1.715, 19.180, 1.915, 1.790, 1.755),
n = c(5, 3, 4, 0, 4)
)
# Add metadata for JAGS model
rytgaard1990_input$N_y <- length(rytgaard1990_input$y)
rytgaard1990_input$N_n <- length(rytgaard1990_input$n)
rytgaard1990_input$min_y <- min(rytgaard1990_input$y)
# ===================================================
# LOAD AND PREPARE CASDATASETS DATA
# ===================================================
data(itamtplcost)
# Extract year and rename 'UltimateCost' for clarity
itamtplcost$year <- format(as.Date(itamtplcost$Date, format = "%d/%m/%Y"), "%Y")
itamtplcost <- itamtplcost %>%
rename(claim_amount = UltimateCost) %>%
select(year, claim_amount)
itamtplcost_input <- list(
y = itamtplcost$claim_amount,
n = itamtplcost %>% group_by(year) %>% summarise(count=n()) %>% pull(count)
)
itamtplcost_input$N_y <- length(itamtplcost_input$y)
itamtplcost_input$N_n <- length(itamtplcost_input$n)
itamtplcost_input$min_y <- min(itamtplcost_input$y)
# ===================================================
# DEFINE BAYESIAN MODEL (POISSON-PARETO)
# ===================================================
model_code <- "
model {
for(i in 1:N_y) {
y[i] ~ dpar(alpha, beta)
}
for(i in 1:N_n) {
n[i] ~ dpois(theta)
}
alpha ~ dgamma(1, 0.0001)
beta ~ dgamma(1, 0.0001)I(, min_y)
theta ~ dgamma(1, 0.0001)
}
"
# Initial values for three MCMC chains
inits_list <- list(
list(alpha = 0.00001, beta = 0.00001, theta = 0.00001),
list(alpha = 100000, beta = 1, theta = 100000),
list(alpha = 3.076, beta = 1.625, theta = 3.2)
)
# ===================================================
# RUN JAGS MODEL
# ===================================================
jags_model <- jags.model(
textConnection(model_code),
data = rytgaard1990_input,
inits = inits_list,
n.chains = 3,
n.adapt = 20000
)
# Sample from posterior
samples <- coda.samples(
jags_model,
variable.names = c("alpha", "beta", "theta"),
n.iter = 50000
)
# Trim the samples (keep 20,000 to 50,000 iterations)
samples_trimmed <- window(samples, start = 1, end = 50000)
samples_trimmed <- window(samples, start = 1, end = 50000)
# Posterior summary & diagnostics
summary(samples_trimmed)
# Trace plots for each parameter
traceplot(samples_trimmed[, "alpha"])
# Trace plots for each parameter
traceplot(samples_trimmed[, "alpha"])
traceplot(samples_trimmed[, "beta"])
traceplot(samples_trimmed[, "theta"])
# Compute the average expected claim amount
pareto_ev <- function(a, b) ifelse(a > 1, (a * b) / (a - 1), NA)
posterior <- as.matrix(samples_trimmed)
expected_values <- pareto_ev(posterior[, "alpha"], posterior[, "beta"])
mean(expected_values, na.rm=TRUE)
sd(expected_values, na.rm=TRUE)
quantile(expected_values, c(0.025, 0.5, 0.975), na.rm=TRUE)
# Density for each parameter
plot(density(samples_trimmed[, "alpha"]))
# Density for each parameter
samples_trimmed[, "alpha"]
# Density for each parameter
as.matrix(samples_trimmed[, "alpha"])
# Density for each parameter
plot(density(as.matrix(samples_trimmed[, "alpha"])))
plot(density(as.matrix(samples_trimmed[, "alpha"])), axes=FALSE, xlab="", ylab="Density")
plot(density(as.matrix(samples_trimmed[, "alpha"])), xlab="", ylab="Density")
plot(density(as.matrix(samples_trimmed[, "alpha"])), xlab="")
plot(density(as.matrix(samples_trimmed[, "alpha"])), main="", xlab="")
plot(density(as.matrix(samples_trimmed[, "beta"])), main="", xlab="")
plot(density(as.matrix(samples_trimmed[, "theta"])), main="", xlab="")
plot(density(expected_values), main="", xlab="")
plot(density(expected_values, na.rm=TRUE), main="", xlab="")
summary(expected_values)
expected_values_without_max <- expected_values[expected_values != max(expected_values)]
plot(density(expected_values_without_max, na.rm=TRUE), main="", xlab="")
expected_values != max(expected_values)
expected_values_without_max <- expected_values[expected_values != max(expected_values, na.rm=TRUE)]
plot(density(expected_values_without_max, na.rm=TRUE), main="", xlab="")
plot(density(expected_values, na.rm=TRUE), main="", xlab="")
plot(density(expected_values, na.rm=TRUE), main="", xlab="", ylab="")
# Density for each parameter
plot(density(as.matrix(samples_trimmed[, "alpha"])), main="", xlab="", ylab="")
plot(density(as.matrix(samples_trimmed[, "beta"])), main="", xlab="", ylab="")
plot(density(as.matrix(samples_trimmed[, "theta"])), main="", xlab="", ylab="")
plot(density(expected_values, na.rm=TRUE), main="", xlab="", ylab="")
# ===================================================
# PLOT 1: EMPIRICAL VS POSTERIOR PARETO CDF
# ===================================================
y <- rytgaard1990_input$y
alpha <- mean(posterior[, "alpha"])
beta <- mean(posterior[, "beta"])
# Define Pareto CDF
pareto_cdf <- function(x, alpha, beta) {
ifelse(x < beta, 0, 1 - (beta / x)^alpha)
}
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "Empirical vs. Posterior Pareto CDF",
xlab = "Claim Amount",
ylab = "CDF",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
legend = c("Empirical CDF", "Posterior Pareto CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
alpha
legend("bottomright",
#       legend = c("Empirical CDF", "Posterior Pareto CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
#       legend = c("Empirical CDF", "Posterior Pareto CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
#       legend = c("Empirical CDF", "Posterior Pareto CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
#  main = "Empirical vs. Posterior Pareto CDF",
xlab = "Claim Amount",
ylab = "CDF",
lwd = 2
)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
#  main = "Empirical vs. Posterior Pareto CDF",
xlab = "Claim Amount",
ylab = "CDF",
lwd = 2
)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
#  main = "Empirical vs. Posterior Pareto CDF",
xlab = "Claim Amount",
ylab = "CDF",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
xlab = "",
ylab = "",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
legend = c("Empirical CDF", "Posterior Pareto CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
legend("bottomright",
legend = c("Empirical CDF", "Pareto(3.079, 1.591) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
legend("bottomright",
legend = c("Empirical CDF", "Pareto(3.079,1.591) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
xlab = "",
ylab = "y",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
legend = c("Empirical CDF", "Pareto(3.079,1.591) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
xlab = "",
ylab = "y",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
legend = c("Empirical CDF", "Pareto(3.079,1.591) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
xlab = "",
ylab = "",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
legend = c("Empirical CDF", "Pareto(3.079,1.591) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Plot empirical CDF for Poisson counts
plot(
ecdf(n),
col = "blue",
main = "",
xlab = "",
ylab = "",
lwd = 2,
xlim = c(min(n), max(n) + 3)  # extend x-axis for visibility
)
# Plot empirical CDF for Poisson counts
plot(
ecdf(n),
col = "blue",
main = "",
xlab = "",
ylab = "",
lwd = 2,
xlim = c(min(n), max(n) + 3)  # extend x-axis for visibility
)
# Plot empirical CDF for Poisson counts
plot(
ecdf(n),
col = "blue",
main = "",
xlab = "",
ylab = "",
lwd = 2
#  ,
#  xlim = c(min(n), max(n) + 3)  # extend x-axis for visibility
)
# ===================================================
# PLOT 2: EMPIRICAL VS POSTERIOR POISSON CDF
# ===================================================
n <- rytgaard1990_input$n
theta <- mean(posterior[, "theta"])
# Plot empirical CDF for Poisson counts
plot(
ecdf(n),
col = "blue",
main = "",
xlab = "",
ylab = "",
lwd = 2,
xlim = c(min(n), max(n) + 3)  # extend x-axis for visibility
)
# Overlay theoretical Poisson CDF
x_vals <- min(n):(max(n) + 3)
lines(x_vals, ppois(x_vals, lambda = theta),
col = "red", lwd = 2, lty = 2, type = "s")  # 's' for step
legend("bottomright",
legend = c("Empirical CDF", "Poisson(3.4) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
xlab = "y",
ylab = "",
lwd = 2
)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
xlab = "y",
ylab = "CDF",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
legend = c("Empirical CDF", "Pareto(3.079,1.591) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# Plot empirical CDF
plot(
ecdf(y),
col = "blue",
main = "",
xlab = "y",
ylab = "",
lwd = 2
)
# Overlay posterior predictive Pareto CDF
x_vals <- seq(min(y), max(y), length.out = 500)
lines(x_vals, pareto_cdf(x_vals, alpha, beta),
col = "red", lwd = 2, lty = 2)
legend("bottomright",
legend = c("Empirical CDF", "Pareto(3.079,1.591) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
# ===================================================
# PLOT 2: EMPIRICAL VS POSTERIOR POISSON CDF
# ===================================================
n <- rytgaard1990_input$n
theta <- mean(posterior[, "theta"])
# Plot empirical CDF for Poisson counts
plot(
ecdf(n),
col = "blue",
main = "",
xlab = "n",
ylab = "",
lwd = 2,
xlim = c(min(n), max(n) + 3)  # extend x-axis for visibility
)
# Overlay theoretical Poisson CDF
x_vals <- min(n):(max(n) + 3)
lines(x_vals, ppois(x_vals, lambda = theta),
col = "red", lwd = 2, lty = 2, type = "s")  # 's' for step
legend("bottomright",
legend = c("Empirical CDF", "Poisson(3.4) CDF"),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
jags_model <- jags.model(
textConnection(model_code),
data = rytgaard1990_input,
inits = inits_list,
n.chains = 3,
n.adapt = 0
)
samples <- coda.samples(
jags_model,
variable.names = c("alpha", "beta", "theta"),
n.iter = 50000
)
gelman_results <- gelman.diag(samples)
within_variance <- gelman_results$psrf[, 1]  # Within-chain variance
within_variance
between_variance <- gelman_results$psrf[, 2]  # Between-chain variance
between_variance
# NEW
# Diagnostics
jags_model <- jags.model(
textConnection(model_code),
data = rytgaard1990_input,
inits = inits_list,
n.chains = 3,
n.adapt = 0
)
# Sample from posterior
samples <- coda.samples(
jags_model,
variable.names = c("alpha", "beta", "theta"),
n.iter = 50000
)
gelman.diag(samples, autoburnin = 10000)
gelman.diag(samples, autoburnin = 20000)
# NEW
# Diagnostics
jags_model <- jags.model(
textConnection(model_code),
data = rytgaard1990_input,
inits = inits_list,
n.chains = 3,
n.adapt = 0
)
# Sample from posterior
samples <- coda.samples(
jags_model,
variable.names = c("alpha", "beta", "theta"),
n.iter = 60000
)
gelman.diag(samples)
# NEW
# Diagnostics
jags_model <- jags.model(
textConnection(model_code),
data = rytgaard1990_input,
inits = inits_list,
n.chains = 3,
n.adapt = 0
)
# Sample from posterior
samples <- coda.samples(
jags_model,
variable.names = c("alpha", "beta", "theta"),
n.iter = 100000
)
gelman.diag(samples)
gelman.plot(samples)
# NEW
# Diagnostics
gelman.diag(samples_trimmed)
gelman.plot(samples_trimmed)
# NEW
# Diagnostics
gelman.diag(samples_trimmed, autoburnin=FALSE)
gelman.plot(samples_trimmed, autoburnin=FALSE)
# NEW
# Diagnostics
gelman.diag(samples_trimmed, autoburnin=FALSE)
gelman.plot(samples_trimmed)
# NEW
# Diagnostics
jags_model <- jags.model(
textConnection(model_code),
data = rytgaard1990_input,
inits = inits_list,
n.chains = 3,
n.adapt = 0
)
# Sample from posterior
samples <- coda.samples(
jags_model,
variable.names = c("alpha", "beta", "theta"),
n.iter = 50000
)
gelman.diag(samples)
gelman.plot(samples)
# NEW
# Diagnostics
gelman.diag(samples_trimmed, autoburnin=FALSE)
gelman.plot(samples_trimmed)
